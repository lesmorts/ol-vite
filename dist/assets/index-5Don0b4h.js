import{Z as he,o as v,c as F,K as Q,a5 as P,a6 as I,a as m,a0 as d,r as ge,$ as _,O as D,P as o,M as n,s as _e,W as we,Q as N,a7 as ye}from"./@vue-NpMCybwX.js";import{E as Me,a as q,b as K,c as U,d as J,e as ve,f as Se,g as Oe,h as Ce}from"./element-plus-RghvUFi-.js";import{g as xe,a as be,W as Le,b as Ee,c as De,T as M,B as T,M as ee,V as te,d as se,F as Pe,Z as Ie,e as ke,O as Be,X as B,S as $e,f as Ae,h as G,i as H,j,k as Te,l as $,t as Fe,m as ze,n as Ve,D as W,o as R,p as b,q as A,C as Y,P as Ne,L as Ge,u as He,r as je,s as We}from"./ol-am7_AEWJ.js";import{c as Re,d as Ye}from"./@vueuse-Qkpz9HYj.js";import{M as Ze}from"./mitt-AJzr52ed.js";import{E as Xe}from"./@element-plus-P_t_KH8t.js";import"./@popperjs--N-3kK7X.js";import"./lodash-es-LjAFrSJZ.js";import"./@ctrl-ZggoHSuR.js";import"./rbush-WFxHU4Du.js";import"./quickselect-Wt3PCiJz.js";import"./color-space-zH90sz_n.js";import"./color-rgba-hzzYTatp.js";import"./color-parse-bonLCUjS.js";import"./color-name-uEINnYyl.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))u(a);new MutationObserver(a=>{for(const s of a)if(s.type==="childList")for(const i of s.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&u(i)}).observe(document,{childList:!0,subtree:!0});function p(a){const s={};return a.integrity&&(s.integrity=a.integrity),a.referrerPolicy&&(s.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?s.credentials="include":a.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function u(a){if(a.ep)return;a.ep=!0;const s=p(a);fetch(a.href,s)}})();const c=he({overlayMessage:"off",message:"projection",themeMessage:"true",drawMessage:"drawOff",measureMessage:"mOff",isMainMap:!0,isWMTS:!1,isClearAll:!1,setMessage(e){this.message=e},setOverlayMessage(e){this.overlayMessage=e},setThemeMessage(e){this.themeMessage=e},setDrawMessage(e){this.drawMessage==="drawOff"?this.drawMessage=e:e==="pointOn"?this.drawMessage==="pointOn"?this.drawMessage="pointOff":this.drawMessage=e:e==="lineOn"?this.drawMessage==="lineOn"?this.drawMessage="lineOff":this.drawMessage=e:e==="polygonOn"?this.drawMessage==="polygonOn"?this.drawMessage="polygonOff":this.drawMessage=e:e==="circleOn"?this.drawMessage==="circleOn"?this.drawMessage="circleOff":this.drawMessage=e:this.drawMessage=e},setMesureMessage(e){this.measureMessage==="mOff"?this.measureMessage=e:e==="LineStringOn"?this.measureMessage==="LineStringOn"?this.measureMessage="LineStringOff":this.measureMessage=e:e==="PolygonOn"?this.measureMessage==="PolygonOn"?this.measureMessage="PolygonOff":this.measureMessage=e:this.measureMessage=e},setIsMainMap(){this.isMainMap=!this.isMainMap},setISWMTSMap(){this.isWMTS=!this.isWMTS}}),x=(e,t)=>{const p=e.__vccOpts||e;for(const[u,a]of t)p[u]=a;return p},Qe={name:"WMTS-map",props:{},data(){return{map:null,view:null,layers:[],state:c,projection:xe("EPSG:3857"),tileSizePixels:256,tileStizeMtrs:null,matrixIds:[],resolutions:[],scalgoToken:"CC5BF28A7D96B320C7DFBFD1236B5BEB"}},mounted(){this.initMap()},methods:{initMap(){this.tileStizeMtrs=be(this.projection.getExtent())/this.tileSizePixels;for(let s=0;s<=14;s++)this.matrixIds[s]=s,this.resolutions[s]=this.tileStizeMtrs/Math.pow(2,s);const e=new Le({origin:Ee(this.projection.getExtent()),resolutions:this.resolutions,matrixIds:this.matrixIds}),t=new De({url:"https://ts2.scalgo.com/olpatch/wmts?token="+this.scalgoToken,layer:"SRTM_4_1:SRTM_4_1_flooded_sealevels",format:"image/png",matrixSet:"EPSG:3857",attributions:['<a href="https://scalgo.com" target="_blank">SCALGO</a>','<a href="https://cgiarcsi.community/data/srtm-90m-digital-elevation-database-v4-1" target="_blank">CGIAR-CSI SRTM</a>'],tileGrid:e,style:"default",dimensions:{threshold:200}});let p=new M({title:"BingStateLayer",source:new T({key:"AmzdYQAaruRYfFwNTOvbca0Eff6h5_Af8PdRMININk1c-3tcObLxQe_XNwLl38Ow",imagerySet:"Aerial"})});this.map=new ee({target:"map",view:new te({projection:this.projection,center:[126856038e-1,25787147e-1],zoom:12,maxZoom:18,minZoom:3}),controls:se({attribution:!1,zoom:!1}),layers:[p,new M({opacity:.5,source:t})]});const u=document.getElementById("slider"),a=function(){t.updateDimensions({threshold:u.value}),document.getElementById("theinfo").innerHTML=u.value+" meters"};u.addEventListener("input",a),a()}}},k=e=>(P("data-v-a0652ab1"),e=e(),I(),e),qe=k(()=>m("div",{class:"map",id:"map"},null,-1)),Ke=k(()=>m("label",null,[d(" Sea-level "),m("input",{id:"slider",type:"range",value:"5",max:"100",min:"-1"})],-1)),Ue=k(()=>m("span",{id:"theinfo"},null,-1)),Je=k(()=>m("p",null,"连续改变维度参数（dimension）时平滑的载入图层,演示的图层是全球海平面计算数据。当海平面上升到 x 米的时候，被淹没的地方会被染成蓝色",-1));function et(e,t,p,u,a,s){return v(),F(Q,null,[qe,Ke,Ue,Je],64)}const tt=x(Qe,[["render",et],["__scopeId","data-v-a0652ab1"]]);var w=null,L=null,E=null,y=null,C=null,Z=null;const st={name:"ol-map",props:{},data(){return{view:null,map:null,vectorSource:null,layers:[],state:c,fullScreen:new Pe,zoomSlider:new Ie,zoomtoextent:new ke({extent:[15437211,4210102,15450282,4217104]}),overviewMapControl:new Be({layers:[new M({source:new B({url:"http://webst0{1-4}.is.autonavi.com/appmaptile?lang=zh_cn&size=1&scale=1&style=7&x={x}&y={y}&z={z}"})})],collapseLabel:"»",label:"«",collapsed:!1}),scaControl:new $e({units:"metric"}),mousePositionControl:new Ae({coordinateFormat:G(2),projection:"EPSG:4326",target:document.getElementById("mouse-position")}),overlay:null,drwDraw:null,drwSourse:null,drwVector:null,drawLayers:[],drawElements:[],mDraw:null}},watch:{"state.overlayMessage":{handler(e){e==="on"?(this.map.on("click",this.overlayHandler),console.log(`popup:${e}`)):e==="off"&&(this.removeOverlay(),console.log(`popup:${e}`))},deep:!0},"state.drawMessage":{handler(e,t){console.log(`newVal:${e} oldVal:${t}`),e==="pointOn"?(this.map.removeInteraction(this.drwDraw),this.addDrawInteraction()):e==="lineOn"?(this.map.removeInteraction(this.drwDraw),this.addDrawInteraction()):e==="polygonOn"?(this.map.removeInteraction(this.drwDraw),this.addDrawInteraction()):e==="circleOn"?(this.map.removeInteraction(this.drwDraw),this.addDrawInteraction()):this.map.removeInteraction(this.drwDraw)},deep:!0},"state.measureMessage":{handler(e,t){console.log(`newVal:${e} oldVal:${t}`),e==="LineStringOn"?(this.map.removeInteraction(this.mDraw),this.Measure()):e==="PolygonOn"?(this.map.removeInteraction(this.mDraw),this.Measure()):this.measureCancel()},deep:!0},"state.isClearAll":{handler(e,t){console.log(`newVal:${e} oldVal:${t}`),e&&(c.isClearAll=!1,this.drwVector.getSource().clear())}}},mounted(){this.initMap(),this.addPopup(),this.$bus.on("layerChange",e=>{this.layers.forEach(t=>{t.values_.title===e?t.setVisible(!0):t.values_.title!=="drwVector"&&t.setVisible(!1)})}),this.$bus.on("projectionChange",e=>{(e==="EPSG:3857"||e==="EPSG:4326")&&this.mousePositionControl.setProjection(e)})},unmounted(){this.$bus.off("layerChange"),this.$bus.off("projectionChange")},methods:{initMap(){let e=new M({title:"BingStateLayer",source:new T({key:"AmzdYQAaruRYfFwNTOvbca0Eff6h5_Af8PdRMININk1c-3tcObLxQe_XNwLl38Ow",imagerySet:"Aerial"})}),t=new M({title:"BingLayer",source:new T({key:"AmzdYQAaruRYfFwNTOvbca0Eff6h5_Af8PdRMININk1c-3tcObLxQe_XNwLl38Ow",imagerySet:"RoadOnDemand"}),visible:!1}),p=new M({title:"gdLayer",source:new B({url:"http://webst0{1-4}.is.autonavi.com/appmaptile?lang=zh_cn&size=1&scale=1&style=7&x={x}&y={y}&z={z}"}),visible:!1}),u=new M({title:"gdStateLayer",source:new B({url:"http://webst0{1-4}.is.autonavi.com/appmaptile?lang=zh_cn&size=1&scale=1&style=6&x={x}&y={y}&z={z}"}),visible:!1});this.layers.push(e),this.layers.push(t),this.layers.push(p),this.layers.push(u),this.view=new te({center:[126735243542e-4,25873856452e-4],rotation:-Math.PI/8,zoom:12.5,maxZoom:18,minZoom:3}),this.drwSourse=new H({wrapX:!1}),this.drwVector=new j({title:"drwVector",source:this.drwSourse,style:{"fill-color":"rgba(255, 255, 255, 0.2)","stroke-color":"#ffcc33","stroke-width":2,"circle-radius":7,"circle-fill-color":"#ffcc33"}}),this.layers.push(this.drwVector),this.map=new ee({target:"map",layers:this.layers,view:this.view,controls:se({attribution:!1}).extend([this.fullScreen,this.zoomtoextent,this.zoomSlider,this.overviewMapControl,this.scaControl,this.mousePositionControl]),overlays:[],interactions:Te().extend([])})},addPopup(){var e=document.getElementById("popup");this.overlay=new $({element:e,autoPan:!0,autoPanAnimation:{duration:250}}),this.map.addOverlay(this.overlay)},overlayHandler(e){var t=document.getElementById("popup-closer"),p=document.getElementById("popup-content");let u=e.coordinate;const a=Fe(ze(u)),s=G(1),i=s(u).toString(),l=s(Ve(u,"EPSG:3857","EPSG:4326")).toString();p.innerHTML=`<span>You clicked here:</span><br>
             lon&lat: <code>`+a+`</code><br>
             coord: <br><code>`+i+"</code>/<code>"+l+"</code>",this.overlay.setPosition(e.coordinate),t.onclick=()=>(this.overlay.setPosition(void 0),t.blur(),!1)},removeOverlay(){this.overlay.setPosition(void 0),this.map.un("click",this.overlayHandler)},addDrawInteraction(){let e="";c.drawMessage==="pointOn"?e="Point":c.drawMessage==="lineOn"?e="LineString":c.drawMessage==="polygonOn"?e="Polygon":c.drawMessage==="circleOn"&&(e="Circle"),e!=="Drawing"&&(this.drwDraw=new W({source:this.drwSourse,type:e}),this.map.addInteraction(this.drwDraw))},Measure(){let e="";c.measureMessage==="LineStringOn"?e="LineString":c.measureMessage==="PolygonOn"&&(e="Polygon");let t=new H;const p=new j({source:t,style:new R({fill:new b({color:"rgba(66, 161, 255,0.2)"}),stroke:new A({color:"rgb(66, 161, 255)",width:4}),image:new Y({radius:7,fill:new b({color:"rgba(66, 161, 255,0.2)"})})})});this.map.on("pointermove",this.measureHandler),this.map.getViewport().addEventListener("mouseout",function(){w.classList.add("hidden")}),this.mDraw=new W({source:t,type:e,style:new R({fill:new b({color:"rgba(66, 161, 255,0.2)"}),stroke:new A({color:"rgba(0, 0, 0, 0.5)",lineDash:[10,10],width:4}),image:new Y({radius:5,stroke:new A({color:"rgba(66, 161, 255,0.7)"}),fill:new b({color:"rgba(66, 161, 255,0.2)"})})})}),this.mDraw.on("drawstart",s=>{L=s.feature;let i=s.coordinate;Z=L.getGeometry().on("change",function(l){const r=l.target;let g;r instanceof Ne?(g=a(r),i=r.getInteriorPoint().getCoordinates()):r instanceof Ge&&(g=u(r),i=r.getLastCoordinate()),i=r.getLastCoordinate(),y.innerHTML=g,C.setPosition(i)})}),this.mDraw.on("drawend",()=>{y.className="ol-tooltip ol-tooltip-static",C.setOffset([0,-7]),L=null,y=null,this.createMeasureTooltip(),He(Z)});const u=function(s){const i=je(s);let l;return i>100?l=Math.round(i/1e3*100)/100+" km":l=Math.round(i*100)/100+" m",l},a=function(s){const i=We(s);let l;return i>1e4?l=Math.round(i/1e6*100)/100+" km<sup>2</sup>":l=Math.round(i*100)/100+" m<sup>2</sup>",l};this.createHelpTooltip(),this.createMeasureTooltip(),this.map.addLayer(p),this.drawLayers.push(p),this.map.addInteraction(this.mDraw)},measureHandler(e){let t="点击开始测量";L&&(t="双击结束测量"),w.innerHTML=t,E.setPosition(e.coordinate),w.classList.remove("hidden")},createMeasureTooltip(){y&&y.parentNode.removeChild(y),y=document.createElement("div"),y.className="ol-tooltip ol-tooltip-measure",C=new $({element:y,offset:[0,-15],positioning:"bottom-center",stopEvent:!1,insertFirst:!1}),this.drawElements.push(C),this.map.addOverlay(C)},createHelpTooltip(){w&&w.parentNode.removeChild(w),w=document.createElement("div"),w.className="ol-tooltip hidden",E=new $({element:w,offset:[15,0],positioning:"center-left"}),this.map.addOverlay(E)},measureCancel(){E.setPosition(void 0),this.map.removeInteraction(this.mDraw),this.map.un("pointermove",this.measureHandler)},getGeoJSON(e){return new URL(Object.assign({})[`./assets/${e}.json`],import.meta.url).href}}},ne=e=>(P("data-v-d201c6ab"),e=e(),I(),e),nt=ne(()=>m("div",{class:"map",id:"map"},null,-1)),ot=ne(()=>m("div",{id:"popup",class:"ol-popup"},[m("a",{href:"#",id:"popup-closer",class:"ol-popup-closer"},"X"),m("div",{id:"popup-content",class:"popup-content"})],-1));function at(e,t,p,u,a,s){return v(),F(Q,null,[nt,ot],64)}const oe=x(st,[["render",at],["__scopeId","data-v-d201c6ab"]]),it={name:"baseSide",props:{},data(){return{isCollapse:ge(!0),layerFlag:"BingStateLayer",state:c,opends:[2]}},mounted(){},methods:{handleOpen(e,t){console.log(e,t)},handleClose(e,t){console.log(e,t)},layerchange(e){this.layerFlag=e,this.$bus.emit("layerChange",this.layerFlag)},toggleCollapse(){this.isCollapse=!this.isCollapse},drawMessage(e){this.state.setDrawMessage(e)},measureMessage(e){this.state.setMesureMessage(e)},OverlayChange(){c.overlayMessage==="off"?c.setOverlayMessage("on"):c.setOverlayMessage("off")}}},z=e=>(P("data-v-9356c64e"),e=e(),I(),e),lt=z(()=>m("span",null,"图层切换",-1)),rt=z(()=>m("span",null,"绘图",-1)),ut=z(()=>m("span",null,"测量",-1));function dt(e,t,p,u,a,s){const i=_("DArrowRight"),l=Me,r=q,g=_("Location"),O=_("Grid"),f=K,S=U,re=_("EditPen"),ue=_("House"),de=_("Aim"),ce=_("Memo"),pe=_("SemiSelect"),me=_("FullScreen"),fe=J;return v(),D(fe,{"default-active":"1",class:"el-menu-vertical-demo",collapse:a.isCollapse,onOpen:s.handleOpen,onClose:s.handleClose,"unique-opened":!0},{default:o(()=>[n(r,{index:"1",onClick:t[0]||(t[0]=h=>s.toggleCollapse())},{default:o(()=>[n(l,null,{default:o(()=>[n(i)]),_:1})]),_:1}),n(r,{onClick:t[1]||(t[1]=h=>s.OverlayChange())},{title:o(()=>[d("Overlay标注")]),default:o(()=>[n(l,null,{default:o(()=>[n(g)]),_:1})]),_:1}),n(S,{index:"2"},{title:o(()=>[n(l,null,{default:o(()=>[n(O)]),_:1}),lt]),default:o(()=>[n(f,{title:"高德"},{default:o(()=>[n(r,{index:"2-1",onClick:t[2]||(t[2]=h=>{s.layerchange("gdStateLayer")})},{default:o(()=>[d("卫星")]),_:1}),n(r,{index:"2-2",onClick:t[3]||(t[3]=h=>s.layerchange("gdLayer"))},{default:o(()=>[d("街道")]),_:1})]),_:1}),n(f,{title:"BingMap"},{default:o(()=>[n(r,{index:"2-3",onClick:t[4]||(t[4]=h=>s.layerchange("BingStateLayer"))},{default:o(()=>[d("卫星")]),_:1}),n(r,{index:"2-4",onClick:t[5]||(t[5]=h=>s.layerchange("BingLayer"))},{default:o(()=>[d("街道")]),_:1})]),_:1})]),_:1}),n(S,{index:"3"},{title:o(()=>[n(l,null,{default:o(()=>[n(re)]),_:1}),rt]),default:o(()=>[n(r,{index:"3-1",onClick:t[6]||(t[6]=h=>s.drawMessage("pointOn"))},{default:o(()=>[d("  ·   点")]),_:1}),n(r,{index:"3-2",onClick:t[7]||(t[7]=h=>s.drawMessage("lineOn"))},{default:o(()=>[d("  |   线")]),_:1}),n(r,{index:"3-3",onClick:t[8]||(t[8]=h=>s.drawMessage("polygonOn"))},{default:o(()=>[n(l,null,{default:o(()=>[n(ue)]),_:1}),d("多边形")]),_:1}),n(r,{index:"3-4",onClick:t[9]||(t[9]=h=>s.drawMessage("circleOn"))},{default:o(()=>[n(l,null,{default:o(()=>[n(de)]),_:1}),d("圆")]),_:1})]),_:1}),n(S,{index:"4"},{title:o(()=>[n(l,null,{default:o(()=>[n(ce)]),_:1}),ut]),default:o(()=>[n(r,{index:"4-1",onClick:t[10]||(t[10]=h=>s.measureMessage("LineStringOn"))},{default:o(()=>[n(l,null,{default:o(()=>[n(pe)]),_:1}),d("距离")]),_:1}),n(r,{index:"4-2",onClick:t[11]||(t[11]=h=>s.measureMessage("PolygonOn"))},{default:o(()=>[n(l,null,{default:o(()=>[n(me)]),_:1}),d("面积")]),_:1})]),_:1})]),_:1},8,["collapse","onOpen","onClose"])}const ae=x(it,[["render",dt],["__scopeId","data-v-9356c64e"]]),ie=Re(),X=Ye(ie),ct={props:[],data(){return{value1:_e(!1),proflag:"EPSG:4326",overlayState:"off",state:c,isDark:ie,toggleDark:X,isdraw:"",opends:["1"]}},watch:{value1:"toggleDark","state.isDrawMessage":{handler(e){this.isdraw=e},deep:!0}},mounted(){this.testTheme()},unmounted(){},methods:{projectionChange(e){this.proflag=e,this.$bus.emit("projectionChange",this.proflag)},testTheme(){this.isDark&&X()},offDraw(){c.setDrawMessage("off")},setWMTSMap(){c.setIsMainMap(),c.setISWMTSMap()},clearAll(){c.isClearAll=!0}}},pt=e=>(P("data-v-c43e5723"),e=e(),I(),e),mt=pt(()=>m("div",{id:"flex-grow"},null,-1));function ft(e,t,p,u,a,s){const i=q,l=K,r=U,g=ve,O=J;return v(),D(O,{class:"el-menu-demo",mode:"horizontal","default-active":"opends"},{default:o(()=>[n(i,{index:"1"},{default:o(()=>[d("Openplayer-Vite")]),_:1}),n(r,{index:"2"},{title:o(()=>[d("OGC资源")]),default:o(()=>[n(l,{title:"加载服务"},{default:o(()=>[n(i,{index:"2-1",onClick:t[0]||(t[0]=f=>{s.setWMTSMap()})},{default:o(()=>[d("WMTS案例")]),_:1})]),_:1})]),_:1}),n(g,{modelValue:a.isDark,"onUpdate:modelValue":t[1]||(t[1]=f=>a.isDark=f),onChange:a.toggleDark,class:"mt-1",size:"large",style:{"--el-switch-on-color":"#409eff","--el-switch-off-color":"#bcdbff",top:"13%"},"inline-prompt":"","active-text":"夜","inactive-text":"日"},null,8,["modelValue","onChange"]),mt,n(i,{index:"3",onClick:t[2]||(t[2]=f=>s.offDraw())},{default:o(()=>[m("span",null,we(a.isdraw),1)]),_:1}),n(r,{index:"4"},{title:o(()=>[d("坐标")]),default:o(()=>[n(l,{title:"Projection"},{default:o(()=>[n(i,{index:"4-1",onClick:t[3]||(t[3]=f=>s.projectionChange("EPSG:3857"))},{default:o(()=>[d("EPSG:3857")]),_:1}),n(i,{index:"4-2",onClick:t[4]||(t[4]=f=>s.projectionChange("EPSG:4326"))},{default:o(()=>[d("EPSG:4326")]),_:1})]),_:1})]),_:1}),n(i,{index:"5-1",onClick:t[5]||(t[5]=f=>s.clearAll())},{default:o(()=>[d("删除绘图")]),_:1})]),_:1})}const le=x(ct,[["render",ft],["__scopeId","data-v-c43e5723"]]),ht={components:{BaseHeader:le,BaseSide:ae,HelloWorld:oe},data(){return{state:c}},mounted(){},unmounted(){},methods:{}},gt={class:"common-layout"};function _t(e,t,p,u,a,s){const i=le,l=Oe,r=ae,g=oe,O=tt,f=Ce,S=Se;return v(),F("div",gt,[n(S,null,{default:o(()=>[n(l,{style:{padding:"0"}},{default:o(()=>[n(i)]),_:1}),n(S,{class:"main-container"},{default:o(()=>[n(r,{class:"baseSide"}),n(f,{style:{padding:"0"}},{default:o(()=>[a.state.isMainMap?(v(),D(g,{key:0})):N("",!0),a.state.isWMTS?(v(),D(O,{key:1})):N("",!0)]),_:1})]),_:1})]),_:1})])}const wt=x(ht,[["render",_t]]),V=ye(wt);V.config.globalProperties.$bus=new Ze;for(const[e,t]of Object.entries(Xe))V.component(e,t);V.mount("#app");
